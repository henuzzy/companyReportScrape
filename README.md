# 公司年报爬取工具

一个用于从新浪财经爬取公司年度报告（PDF格式）的自动化工具，支持批量下载、年份筛选、并发下载等功能。

## 功能特点

- ✅ 支持批量输入股票代码（txt文件）
- ✅ 自动尝试多种URL格式（可扩展）
- ✅ 支持年份范围筛选
- ✅ 并发下载（默认10个并发）
- ✅ 断点续传（基于临时文件）
- ✅ 去重功能（已下载文件自动跳过）
- ✅ 可视化GUI界面
- ✅ 实时进度显示和日志记录

## 项目结构

```
companyReportScrape/
├── main.py              # 程序入口
├── config/
│   └── config.json      # 配置文件
├── core/                # 核心功能模块
│   ├── scraper.py       # 爬虫核心
│   ├── downloader.py    # 下载模块
│   └── url_handler.py   # URL处理
├── utils/               # 工具模块
│   ├── logger.py        # 日志管理
│   ├── config.py        # 配置管理
│   ├── year_extractor.py # 年份提取
│   └── file_handler.py  # 文件处理
├── gui/                 # GUI界面
│   └── main_window.py   # 主窗口
├── downloads/           # 下载目录（自动创建）
├── logs/                # 日志目录（自动创建）
└── requirements.txt     # 依赖列表
```

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 1. 准备股票代码文件

创建一个txt文件，每行一个股票代码，例如 `stocks.txt`：

```
002131
002195
002202
002203
```

### 2. 运行程序

```bash
python main.py
```

### 3. 使用GUI界面

1. **选择股票代码文件**：点击"选择文件"按钮，选择你的txt文件
2. **设置年份范围**（可选）：
   - 起始年份：如 `2020`
   - 结束年份：如 `2024`
   - 留空表示下载所有年份的年报
3. **设置下载路径**（可选）：默认保存在 `./downloads` 目录
4. **开始下载**：点击"开始下载"按钮

### 4. 查看下载结果

- 下载的文件保存在：`{下载路径}/{股票代码}/{年报名称}.pdf`
- 错误日志保存在：`logs/error.log`
- GUI界面显示实时进度和日志信息

## 配置说明

编辑 `config/config.json` 可以修改配置：

```json
{
  "concurrent_downloads": 10,      // 并发下载数
  "download_base_path": "./downloads",  // 默认下载路径
  "log_level": "ERROR",            // 日志级别
  "log_file": "./logs/error.log",  // 日志文件路径
  "url_formats": [                 // URL格式列表（按顺序尝试）
    "...",
    "..."
  ],
  "request_timeout": 30            // 请求超时时间（秒）
}
```

## 功能说明

### URL格式处理

程序会按顺序尝试配置文件中的URL格式，找到可用的格式后使用。如果发现新的URL格式，可以在 `config.json` 中的 `url_formats` 列表中添加。

### 年份筛选

- 从年报标题中提取年份（如 "2024年年度报告" → 2024）
- 支持指定年份范围筛选
- 如果不指定年份，下载所有可用的年报

### 断点续传

- 下载时先保存为 `.tmp` 临时文件
- 下载完成后重命名为 `.pdf` 文件
- 如果下载中断，下次运行时会重新下载（不检查`.tmp`文件）

### 去重机制

- 基于文件名判断文件是否已下载
- 只检查 `.pdf` 文件，不检查 `.tmp` 文件
- 如果文件已存在，自动跳过下载

## 注意事项

1. 确保网络连接正常
2. 大量下载时注意不要过于频繁请求，避免被反爬
3. 如果遇到下载失败，查看 `logs/error.log` 了解详细错误信息
4. 股票代码格式：A股代码如 `002202`、`000001` 等

## 许可证

本项目仅供学习交流使用。

